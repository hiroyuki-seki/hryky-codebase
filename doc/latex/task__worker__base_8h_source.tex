\hypertarget{task__worker__base_8h_source}{\section{task\-\_\-worker\-\_\-base.\-h}
}

\begin{DoxyCode}
00001 
00009 \textcolor{preprocessor}{#ifndef TASK\_WORKER\_BASE\_H\_20111119163724359}
00010 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define TASK\_WORKER\_BASE\_H\_20111119163724359}
00011 \textcolor{preprocessor}{}\textcolor{preprocessor}{#include "\hyperlink{noncopyable_8h}{hryky/noncopyable.h}"}
00012 \textcolor{preprocessor}{#include "\hyperlink{task__common_8h}{hryky/task/task_common.h}"}
00013 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00014 \textcolor{comment}{// macro definition}
00015 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00016 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00017 \textcolor{comment}{// namespace}
00018 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00019 \textcolor{keyword}{namespace }hryky
00020 \{
00021 \textcolor{keyword}{namespace }task
00022 \{
00023     \textcolor{keyword}{class }Sequence;
00024 
00026 \textcolor{keyword}{namespace }worker
00027 \{
00029     \textcolor{keyword}{class }Base;
00030 \} \textcolor{comment}{// namespace worker}
00031 \} \textcolor{comment}{// namespace task}
00032 \textcolor{keyword}{namespace }exclusion
00033 \{
00034     \textcolor{keyword}{template} < \textcolor{keyword}{typename} LockableT >
00035     \textcolor{keyword}{class }Lock;
00036 \} \textcolor{comment}{// namespace exclusion}
00037 \} \textcolor{comment}{// namespace hryky}
00038 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00039 \textcolor{comment}{// class declaration}
00040 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
\hypertarget{task__worker__base_8h_source_l00046}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{00046} \textcolor{comment}{}\textcolor{keyword}{class }\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{hryky::task::worker::Base} : \hyperlink{classhryky_1_1_noncopyable}{Noncopyable}
00047 \{
00048 \textcolor{keyword}{public} :
00049 
\hypertarget{task__worker__base_8h_source_l00050}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_a7e479f64d3081afe38ac8c001c784b6f}{00050}     \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base}                \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a7e479f64d3081afe38ac8c001c784b6f}{this_type};
00051     \textcolor{keyword}{typedef} Sequence            sequence\_type;
00052 
\hypertarget{task__worker__base_8h_source_l00054}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer}{00054}     \textcolor{keyword}{class }\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer}{Observer}
00055     \{
00056     \textcolor{keyword}{public} :
00057         \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{attach_param_type};
00058         \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{detach_param_type};
00059 
00060         \textcolor{keyword}{struct }ErrorParam
00061         \{
00062             ErrorParam(\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & worker)
00063                 : worker\_(worker)
00064             \{\}
00065 
00066             \hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & worker\_;
00067         \};
00068         \textcolor{keyword}{typedef} ErrorParam error\_param\_type;
00069 
\hypertarget{task__worker__base_8h_source_l00076}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_aef35602a4e0be27fa2adb725c4e5e1c2}{00076}         \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_aef35602a4e0be27fa2adb725c4e5e1c2}{attach}(\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{attach_param_type} worker) \{ this->attach\_impl(worker); \}
00077 
\hypertarget{task__worker__base_8h_source_l00084}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_a006d60c6079bb4b48d4cdac44b5377db}{00084}         \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_a006d60c6079bb4b48d4cdac44b5377db}{detach}(\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{detach_param_type} worker) \{ this->detach\_impl(worker); \}
00085 
\hypertarget{task__worker__base_8h_source_l00091}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_a93a45d6703ea5f96ffaab7fc52cffa73}{00091}         \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer_a93a45d6703ea5f96ffaab7fc52cffa73}{error}(error\_param\_type param) \{ this->error\_impl(param); \}
00092         
00093     \textcolor{keyword}{private} :
00094         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} attach\_impl(attach\_param\_type) = 0;
00095         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} detach\_impl(detach\_param\_type) = 0;
00096         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} error\_impl(error\_param\_type) \{\}
00097     \};
00098     \textcolor{keyword}{typedef} Observer * observer\_type;
00099 
\hypertarget{task__worker__base_8h_source_l00101}{}\hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter}{00101}     \textcolor{keyword}{struct }\hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter}{ResetParameter} : \hyperlink{classhryky_1_1_noncopyable}{Noncopyable}
00102     \{
\hypertarget{task__worker__base_8h_source_l00103}{}\hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter_a44462519af461afb9deaba78f71d0ae8}{00103}         \textcolor{keyword}{typedef} \hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter}{ResetParameter} \hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter_a44462519af461afb9deaba78f71d0ae8}{this_type};
00104 
\hypertarget{task__worker__base_8h_source_l00109}{}\hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter_aa91b63615964cc6d6b3a9507fa06cdef}{00109}         \hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter_aa91b63615964cc6d6b3a9507fa06cdef}{ResetParameter}(sequence\_type & sequence)
00110             : sequence\_(sequence), observer\_(\hyperlink{common_8h_a4cd4ac09cfcdbd6b30ee69afc156e210}{HRYKY_NULLPTR}) \{
00111         \}
00112 
00113     \textcolor{keyword}{private} :
00114         hryky\_accessor\_read(sequence\_type &,    sequence);
00115         hryky\_accessor\_row(\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_observer}{observer_type},       observer);
00116     \};
00117 
\hypertarget{task__worker__base_8h_source_l00121}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_run}{00121}     \textcolor{keyword}{class }\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_run}{Run} : \hyperlink{classhryky_1_1_noncopyable}{Noncopyable}
00122     \{
00123         \textcolor{keyword}{friend} \textcolor{keyword}{class }hryky::task::Sequence;
00124         \hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_run}{Run}(\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & worker) \{ worker.run(); \} 
00125     \};
00126 
\hypertarget{task__worker__base_8h_source_l00130}{}\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_detach}{00130}     \textcolor{keyword}{class }\hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_detach}{Detach} : \hyperlink{classhryky_1_1_noncopyable}{Noncopyable}
00131     \{
00132         \textcolor{keyword}{friend} \textcolor{keyword}{class }hryky::task::Sequence;
00133         \hyperlink{classhryky_1_1task_1_1worker_1_1_base_1_1_detach}{Detach}(\hyperlink{classhryky_1_1task_1_1worker_1_1_base}{Base} & worker) \{ worker.detach(); \}
00134     \};
00135 
00137     \textcolor{keyword}{explicit} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base}();
00138 
00140     \textcolor{keyword}{virtual} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a722da881b6c70cfcbde9243abcfbf334}{~Base}();
00141 
00147     \textcolor{keywordtype}{bool} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a2dfa3093b3165d58ed31aa575ae1b159}{reset}(\hyperlink{structhryky_1_1task_1_1worker_1_1_base_1_1_reset_parameter}{ResetParameter} \textcolor{keyword}{const} & param);
00148 
00159     \textcolor{keywordtype}{bool} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_ae17d5723d8aa5567ea6a47b67f8133c4}{attach}();
00160 
00162     \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_aa39b31ced492faec5dd3b6478b0a98df}{error}();
00163 
00164     \textcolor{comment}{// for statistic}
00165     clock::nanoseconds  pre\_exec\_total()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} this->pre\_exec\_total\_; 
      \}
00166     clock::nanoseconds  in\_exec\_total()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} this->in\_exec\_total\_; \}
00167 
00168 \textcolor{keyword}{protected} :
00169 
00170 \textcolor{keyword}{private} :
00171 
00172     \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1exclusion_1_1_mutex}{exclusion::Mutex}                lockable\_type;
00173     \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1exclusion_1_1_lock}{exclusion::Lock<lockable_type>}  lock\_type;
00174 
00176     \textcolor{keyword}{struct }AutoDetach
00177     \{
00178         AutoDetach(\hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base} & worker)
00179             : worker\_(worker), disable\_(false) \{\}
00180         ~AutoDetach()
00181         \{ \textcolor{keywordflow}{if} (!this->disable\_) \{ this->worker\_.detach(); \} \}
00182 
00183         \textcolor{keywordtype}{void} disable() \{ this->disable\_ = \textcolor{keyword}{true}; \}
00184 
00185         \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base} & worker\_;
00186         \textcolor{keywordtype}{bool} disable\_;
00187     \};
00188 
00190     \textcolor{keyword}{explicit} \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base}(\hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base} \textcolor{keyword}{const} &);
00191 
00193     \hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base} & operator=(\hyperlink{classhryky_1_1task_1_1worker_1_1_base_a5ffe0568374d8b9b4c4ec32953fd6453}{Base} \textcolor{keyword}{const} &);
00194     
00196     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} run\_impl() = 0;
00197 
00203     \textcolor{keywordtype}{void} run();
00204 
00206     \textcolor{keywordtype}{void} detach();
00207 
00209     \textcolor{keywordtype}{bool} operator==(\hyperlink{classhryky_1_1task_1_1worker_1_1_base_a7e479f64d3081afe38ac8c001c784b6f}{this_type} \textcolor{keyword}{const} & rhs) \{
00210         \textcolor{keywordflow}{return} \textcolor{keyword}{this} == &rhs;
00211     \}
00212 
00213     sequence\_type *             sequence\_;
00214     observer\_type               observer\_;
00215     lockable\_type               lockable\_;
00216 
00217     \textcolor{comment}{// for statistic}
00218     clock::nanoseconds          pre\_exec\_total\_;
00219     clock::nanoseconds          in\_exec\_total\_;
00220     
00221     \textcolor{keywordtype}{bool}                        ready\_;
00222     
00223 \};
00224 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00225 \textcolor{comment}{// inline function}
00226 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00227 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00228 \textcolor{comment}{// function prototypes}
00229 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00230 \textcolor{keyword}{namespace }hryky
00231 \{
00232 \textcolor{keyword}{namespace }task
00233 \{
00234 \textcolor{keyword}{namespace }worker
00235 \{
00237     \hyperlink{namespacehryky_a343a9a4c36a586be5c2693156200eadc}{reduction_type} \hyperlink{namespacehryky_1_1task_1_1worker_a69f40c48f750e5d2a8b867f295119dac}{reduce}(\hyperlink{namespacehryky_1_1reduction_ac686c30a4c8d196bbd0f05629a6b921f}{reduction::name_type} \textcolor{keyword}{const} & name, Base \textcolor{keyword}{const} & base)
      ;
00238 
00239 \}
00240 \}
00241 \}
00242 \textcolor{preprocessor}{#endif // TASK\_WORKER\_BASE\_H\_20111119163724359}
00243 \textcolor{preprocessor}{}
00244 \textcolor{comment}{// end of file}
\end{DoxyCode}
