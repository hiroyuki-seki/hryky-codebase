\hypertarget{allocator__heap_8h_source}{\section{allocator\-\_\-heap.\-h}
}

\begin{DoxyCode}
00001 
00007 \textcolor{preprocessor}{#ifndef ALLOCATOR\_HEAP\_H\_20120225184209445}
00008 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define ALLOCATOR\_HEAP\_H\_20120225184209445}
00009 \textcolor{preprocessor}{}\textcolor{preprocessor}{#include "\hyperlink{allocator__base_8h}{hryky/allocator/allocator_base.h}"}
00010 \textcolor{preprocessor}{#include "\hyperlink{common_8h}{hryky/common.h}"}
00011 \textcolor{preprocessor}{#include "\hyperlink{memory__global__common_8h}{hryky/memory/global/memory_global_common.h}"}
00012 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00013 \textcolor{comment}{// macro definition}
00014 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00015 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00016 \textcolor{comment}{// namespace}
00017 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00018 \textcolor{keyword}{namespace }hryky
00019 \{
00020 \textcolor{keyword}{namespace }allocator
00021 \{
00023     \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
00024     \textcolor{keyword}{class }Heap;
00025 \} \textcolor{comment}{// namespace allocator}
\hypertarget{allocator__heap_8h_source_l00026}{}\hyperlink{namespacehryky_1_1memory}{00026} \textcolor{keyword}{namespace }memory
00027 \{
\hypertarget{allocator__heap_8h_source_l00028}{}\hyperlink{namespacehryky_1_1memory_1_1heap}{00028} \textcolor{keyword}{namespace }\hyperlink{namespacehryky_1_1memory_1_1global_a6fc6103f67c837aa0f39b359588409cd}{heap}
00029 \{
00030     \textcolor{keyword}{class }\hyperlink{classhryky_1_1memory_1_1heap_1_1_base}{Base};
00031     
00032 \} \textcolor{comment}{// namespace heap}
00033 \} \textcolor{comment}{// namespace memory}
00034 \} \textcolor{comment}{// namespace hryky}
00035 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00036 \textcolor{comment}{// class declaration}
00037 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00041 \textcolor{comment}{}\textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT = hryky::memory::heap::Base *  >
\hypertarget{allocator__heap_8h_source_l00042}{}\hyperlink{classhryky_1_1allocator_1_1_heap}{00042} \textcolor{keyword}{class }\hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap}
00043     : \textcolor{keyword}{public} \hyperlink{classhryky_1_1allocator_1_1_base}{hryky::allocator::Base}<ValueT>
00044 \{
00045 \textcolor{keyword}{public} :
00046 
00047     \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<ValueT, HeapPtrT>} \hyperlink{classhryky_1_1allocator_1_1_base}{this_type};
00048 
00049     \textcolor{keyword}{template}<\textcolor{keyword}{typename} OtherT>
00050     \textcolor{keyword}{struct }rebind
00051     \{
00052         \textcolor{keyword}{typedef} \hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<OtherT, HeapPtrT>} other;
00053     \};
00054 
00056     \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{Heap}();
00057 
00059     \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{Heap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} \textcolor{keyword}{const} & rhs);
00060 
00062     \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{Heap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} && rhs);
00063 
00065     \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{Heap}(HeapPtrT \hyperlink{classhryky_1_1allocator_1_1_heap_a8e298fe26a676998b9bc5178c79961dc}{heap});
00066 
00068     \textcolor{keyword}{template} < \textcolor{keyword}{typename} OtherT >
00069     \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{Heap}(\hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<OtherT, HeapPtrT>} \textcolor{keyword}{const} & rhs);
00070 
00072     \hyperlink{classhryky_1_1allocator_1_1_heap_a682f65aed73b63b9f7e86d6db413729d}{~Heap}();
00073 
00075     pointer \hyperlink{classhryky_1_1allocator_1_1_heap_aa6049d5dcf3b2ec29cc6597d183e80bc}{allocate}(size\_type count, \textcolor{keywordtype}{void} \textcolor{keyword}{const} * = \hyperlink{common_8h_a4cd4ac09cfcdbd6b30ee69afc156e210}{HRYKY_NULLPTR});
00076 
00078     \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1allocator_1_1_heap_a60545b7067de7bd142ada1b2ff5bf7f9}{deallocate}(pointer ptr, size\_type);
00079 
00081     size\_type \hyperlink{classhryky_1_1allocator_1_1_heap_a6e2a6c2d9a4d9542059b28fca4c4a2d6}{max_size}() \textcolor{keyword}{const};
00082 
00084     HeapPtrT \hyperlink{classhryky_1_1allocator_1_1_heap_a8e298fe26a676998b9bc5178c79961dc}{heap}() \textcolor{keyword}{const};
00085 
00087     \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1allocator_1_1_heap_a855528bfa428ad5289cbdff073311d68}{swap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} & src);
00088 
00089 \textcolor{keyword}{private} :
00090     HeapPtrT    heap\_;
00091 
00092 \};
00093 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00094 \textcolor{comment}{// public member functions}
00095 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00099 \textcolor{comment}{}\textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00100}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{00100} \hyperlink{classhryky_1_1allocator_1_1_heap_a6a7972f4ac65c5c1ad631cb0d4db6590}{hryky::allocator::Heap<ValueT, HeapPtrT>::Heap}()
00101     : heap\_(memory::global::\hyperlink{namespacehryky_1_1memory_1_1global_a6fc6103f67c837aa0f39b359588409cd}{heap}())
00102 \{
00103 \}
00107 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00108}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a8e73ccf19f000b54365cbaf614d2c00d}{00108} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::Heap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} \textcolor{keyword}{const} & rhs)
00109     : heap\_(rhs.heap\_)
00110 \{
00111 \}
00115 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00116}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a053e81bcd62ee93ba4e9650c55217f29}{00116} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::Heap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} && rhs)
00117     : heap\_()
00118 \{
00119     this->\hyperlink{classhryky_1_1allocator_1_1_heap_a855528bfa428ad5289cbdff073311d68}{swap}(rhs);
00120 \}
00124 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00125}{}\hyperlink{classhryky_1_1allocator_1_1_heap_ace223f3243a7e5a396cf7b86f5dcfd0f}{00125} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::Heap}(HeapPtrT \hyperlink{namespacehryky_1_1memory_1_1global_a6fc6103f67c837aa0f39b359588409cd}{heap})
00126     : heap\_(heap)
00127 \{
00128 \}
00132 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
00133 \textcolor{keyword}{template} < \textcolor{keyword}{typename} OtherT >
\hypertarget{allocator__heap_8h_source_l00134}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a73751d2de2bd8ca6a88d7a3c5d2327dd}{00134} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::Heap}(\hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<OtherT, HeapPtrT>} \textcolor{keyword}{const} & 
      rhs)
00135     : heap\_(rhs.\hyperlink{namespacehryky_1_1memory_1_1global_a6fc6103f67c837aa0f39b359588409cd}{heap}())
00136 \{
00137 \}
00141 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00142}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a682f65aed73b63b9f7e86d6db413729d}{00142} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::~Heap}()
00143 \{
00144 \}
00148 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
00149 \textcolor{keyword}{typename} hryky::allocator::Heap<ValueT, HeapPtrT>::pointer
\hypertarget{allocator__heap_8h_source_l00150}{}\hyperlink{classhryky_1_1allocator_1_1_heap_aa6049d5dcf3b2ec29cc6597d183e80bc}{00150} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::allocate}(size\_type count, \textcolor{keywordtype}{void} \textcolor{keyword}{const} 
      *)
00151 \{
00152     \textcolor{keywordflow}{if} (HeapPtrT() == this->heap\_) \{
00153         \textcolor{keywordflow}{return} \hyperlink{common_8h_a4cd4ac09cfcdbd6b30ee69afc156e210}{HRYKY_NULLPTR};
00154     \}
00155 
00156     \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}pointer\textcolor{keyword}{>}(
00157         this->heap\_->allocate(count * \textcolor{keyword}{sizeof}(ValueT)));
00158 \}
00162 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00163}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a60545b7067de7bd142ada1b2ff5bf7f9}{00163} \textcolor{keywordtype}{void} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::deallocate}(pointer ptr, 
      size\_type)
00164 \{
00165     \textcolor{keywordflow}{if} (HeapPtrT() == this->heap\_) \{
00166         \textcolor{keywordflow}{return};
00167     \}
00168 
00169     this->heap\_->\hyperlink{classhryky_1_1allocator_1_1_heap_a60545b7067de7bd142ada1b2ff5bf7f9}{deallocate}(ptr);
00170 \}
00174 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
00175 \textcolor{keyword}{typename} hryky::allocator::Heap<ValueT, HeapPtrT>::size\_type
\hypertarget{allocator__heap_8h_source_l00176}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a6e2a6c2d9a4d9542059b28fca4c4a2d6}{00176} \hyperlink{classhryky_1_1allocator_1_1_heap}{hryky::allocator::Heap<ValueT, HeapPtrT>::max_size}()\textcolor{keyword}{ const}
00177 \textcolor{keyword}{}\{
00178     \textcolor{keywordflow}{if} (HeapPtrT() == this->heap\_) \{
00179         \textcolor{keywordflow}{return} 0;
00180     \}
00181 
00182     \textcolor{keywordflow}{return} this->heap\_->allocatable\_size() / \textcolor{keyword}{sizeof}(value\_type);
00183 \}
00187 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00188}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a8e298fe26a676998b9bc5178c79961dc}{00188} HeapPtrT \hyperlink{namespacehryky_1_1memory_1_1global_a6fc6103f67c837aa0f39b359588409cd}{hryky::allocator::Heap<ValueT, HeapPtrT>::heap}()\textcolor{keyword}{ const}
00189 \textcolor{keyword}{}\{
00190     \textcolor{keywordflow}{return} this->heap\_;
00191 \}
00195 \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT >
\hypertarget{allocator__heap_8h_source_l00196}{}\hyperlink{classhryky_1_1allocator_1_1_heap_a855528bfa428ad5289cbdff073311d68}{00196} \textcolor{keywordtype}{void} \hyperlink{namespacehryky_a4282146df5ea2b68cb667896a2205909}{hryky::allocator::Heap<ValueT, HeapPtrT>::swap}(\hyperlink{classhryky_1_1allocator_1_1_base}{this_type} & src)
00197 \{
00198     \hyperlink{namespacehryky_add9c1c1fdfda07cd47bcb7c16d3a823a}{hryky_swap}(this->heap\_, src.heap\_);
00199 \}
00200 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00201 \textcolor{comment}{// protected member functions}
00202 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00203 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00204 \textcolor{comment}{// private member functions}
00205 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00206 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00207 \textcolor{comment}{// prototypes of global function}
00208 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00209 \textcolor{keyword}{namespace }hryky
00210 \{
00211 \textcolor{keyword}{namespace }allocator
00212 \{
00214     \textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT  >
00215     \textcolor{keywordtype}{void} \hyperlink{namespacehryky_a4282146df5ea2b68cb667896a2205909}{swap}(\hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<ValueT, HeapPtrT>} & lhs, \hyperlink{classhryky_1_1allocator_1_1_heap}{Heap<ValueT, HeapPtrT>} & rhs);
00216 
00217 \}
00218 \}
00219 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00220 \textcolor{comment}{// definitions of global function}
00221 \textcolor{comment}{//
      ------------------------------------------------------------------------------}
00225 \textcolor{comment}{}\textcolor{keyword}{template} < \textcolor{keyword}{typename} ValueT, \textcolor{keyword}{typename} HeapPtrT  >
00226 \textcolor{keywordtype}{void} \hyperlink{namespacehryky_a4282146df5ea2b68cb667896a2205909}{hryky::allocator::swap}(
00227     Heap<ValueT, HeapPtrT> & lhs, Heap<ValueT, HeapPtrT> & rhs)
00228 \{
00229     lhs.swap(rhs);
00230 \}
00231 \textcolor{preprocessor}{#endif // ALLOCATOR\_HEAP\_H\_20120225184209445}
00232 \textcolor{preprocessor}{}\textcolor{comment}{// end of file}
\end{DoxyCode}
