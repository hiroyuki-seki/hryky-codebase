<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>hryky-codebase: concurrent tasks</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->

<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">hryky-codebase
   &#160;<span id="projectnumber">00.00.04</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('hryky_1_1task.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">concurrent tasks </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Concurrency"></a>
hryky::task::Concurrency</h2>
<p><a class="el" href="classhryky_1_1task_1_1_concurrency.html" title="manages concurrency units.">hryky::task::Concurrency</a> has the collection of concurrent units internally. This class generates and manages the concurrent units. Each concurrent unit, hryky::task::Sequence occupies one thread resource. <a class="el" href="classhryky_1_1task_1_1_concurrency.html" title="manages concurrency units.">hryky::task::Concurrency</a> and internal hryky::task::Sequence can be shared between different kinds of <a class="el" href="classhryky_1_1task_1_1distributor_1_1_base.html" title="attaches workers to the concurrent units.">hryky::task::distributor::Base</a> and <a class="el" href="classhryky_1_1task_1_1worker_1_1_base.html" title="executes tasks.">hryky::task::worker::Base</a>.</p>
<h3><a class="anchor" id="Initialization"></a>
Initialization</h3>
<p><div class="fragment"><pre class="fragment">    task::Concurrency concurrency;
    <span class="keywordflow">if</span> (!concurrency.reset(
        task::Concurrency::ResetParameter(
            adapter_heap,
            thread_pool)
        .sequences_size(threads_size)
        .preferred_processors(preferred_processors)))
    {
        <a class="code" href="log__writer__common_8h.html#a8d142be5e91677a27be199c3f4115ba6" title="writes log message as hryky::log::level::Kind::emerg_ level.">hryky_log_emerg</a>(
            (*<a class="code" href="namespacehryky_1_1reduction.html#ac5eae270cf8047b294dc4ff3e5e11a79" title="creates an instance of reduction::Map.">reduction::map</a>(<span class="stringliteral">&quot;failed to reset concurrent module&quot;</span>))
                .append(<span class="stringliteral">&quot;the number of threads&quot;</span>, threads_size));
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
</pre></div></p>
<h2><a class="anchor" id="worker_Base"></a>
hryky::task::worker::Base</h2>
<p><a class="el" href="classhryky_1_1task_1_1worker_1_1_base.html" title="executes tasks.">hryky::task::worker::Base</a> is the interface class of a coarsest-grained unit executed on one concurrent unit. This class shall be derived for an implementation. The method of execution is pure virtual function, therefore a derived class must implement hryky::task::worker::Base::run_impl(). In many cases, the instance of derived class will be used from <a class="el" href="classhryky_1_1task_1_1distributor_1_1_base.html" title="attaches workers to the concurrent units.">hryky::task::distributor::Base</a>. But the derived class can be used without <a class="el" href="classhryky_1_1task_1_1distributor_1_1_base.html" title="attaches workers to the concurrent units.">hryky::task::distributor::Base</a>.</p>
<h2><a class="anchor" id="worker_Batch"></a>
hryky::task::worker::Batch</h2>
<p><a class="el" href="classhryky_1_1task_1_1worker_1_1_batch.html" title="executes tasks in common use.">hryky::task::worker::Batch</a> is one example of the deriviation of <a class="el" href="classhryky_1_1task_1_1worker_1_1_base.html" title="executes tasks.">task::worker::Base</a>. The downside of this implementation is that an execution of worker might occupy the long time period of concurrent unit relatively. This implementation is intended to execute more fine grained tasks than one worker. The implementation of task must be decided staticly. But each task does not call virtual function for light overhead. The instantiation of this class is invoked in <a class="el" href="group__task.html#ga9ebf9038e6e40f583b3b26866e1f8131" title="clears and recreates the resources.">hryky::task::distributor::Batch::reset()</a>. If this class is directly used without <a class="el" href="classhryky_1_1task_1_1worker_1_1_batch.html" title="executes tasks in common use.">hryky::task::worker::Batch</a>, the notifications at attaching and detaching must be implemented.</p>
<h2><a class="anchor" id="worker_distributor_Base"></a>
hryky::task::worker::distributor::Base</h2>
<p><a class="el" href="classhryky_1_1task_1_1distributor_1_1_base.html" title="attaches workers to the concurrent units.">hryky::task::distributor::Base</a> is the interface class to assign workers to the concurrent units. The instance of this class has only the pointers of each worker. The implementations derived from <a class="el" href="classhryky_1_1task_1_1distributor_1_1_base.html" title="attaches workers to the concurrent units.">hryky::task::distributor::Base</a> must hold the entities of each worker.</p>
<h2><a class="anchor" id="worker_distributor_Impl"></a>
hryky::task::worker::distributor::Impl</h2>
<p><a class="el" href="classhryky_1_1task_1_1distributor_1_1_impl.html" title="base class of implementation for task::distributor::Base.">hryky::task::distributor::Impl</a> is utility class to hold the implementation of workers.</p>
<h2><a class="anchor" id="worker_distributor_Batch"></a>
hryky::task::worker::distributor::Batch</h2>
<p><a class="el" href="classhryky_1_1task_1_1distributor_1_1_batch.html" title="manages workers which executes multiple tasks.">hryky::task::distributor::Batch</a> instantiates <a class="el" href="classhryky_1_1task_1_1worker_1_1_batch.html" title="executes tasks in common use.">task::worker::Batch</a> and assign them to each concurrent unit. This class has the methods to distribute multiple tasks to each worker.</p>
<h3><a class="anchor" id="Initialization"></a>
Initialization</h3>
<p><div class="fragment"><pre class="fragment">    distributor_type distributor;
    <span class="keywordflow">if</span> (!distributor.reset(
        distributor_type::ResetParameter(concurrency)
        .batch_size(batch_size)))
    {
        <a class="code" href="log__writer__common_8h.html#a8d142be5e91677a27be199c3f4115ba6" title="writes log message as hryky::log::level::Kind::emerg_ level.">hryky_log_emerg</a>(
            (*<a class="code" href="namespacehryky_1_1reduction.html#ac5eae270cf8047b294dc4ff3e5e11a79" title="creates an instance of reduction::Map.">reduction::map</a>(<span class="stringliteral">&quot;failed to reset a task distributor&quot;</span>))
            .append(<span class="stringliteral">&quot;the size of a batch of tasks&quot;</span>, batch_size));
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
</pre></div></p>
<h3><a class="anchor" id="Distribution"></a>
Distribution of each task to concurrent units</h3>
<p><div class="fragment"><pre class="fragment">        <span class="keywordflow">if</span> (!distributor.distribute(task_type(task_id))) {
</pre></div></p>
<h3><a class="anchor" id="attach"></a>
assignment of workers to each concurrent unit</h3>
<p><div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span> (!distributor.attach()) {
</pre></div></p>
<h3><a class="anchor" id="join"></a>
wait until the workers complete tasks</h3>
<p><div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span> (!distributor.join()) {
</pre></div></p>
<h3><a class="anchor" id="HelloTask"></a>
Simple task</h3>
<p>The example of implementation of an operation for <a class="el" href="classhryky_1_1task_1_1worker_1_1_batch.html" title="executes tasks in common use.">task::worker::Batch</a>. This operation merely prints "hello" along with the index of task.</p>
<p><div class="fragment"><pre class="fragment">    <span class="keyword">struct </span>HelloTask
    {
        <span class="keyword">typedef</span> task::distributor::Batch&lt;HelloTask&gt;
            distributor_type;
        
        <span class="keyword">typedef</span> task::worker::Batch&lt;HelloTask&gt;
            worker_type;
        
        HelloTask() : id_(0) {}
        
        HelloTask(<span class="keywordtype">size_t</span> <span class="keywordtype">id</span>) : id_(id) {}

        <span class="keywordtype">void</span> operator()(worker_type &amp;);

        <a class="code" href="namespacehryky.html#a343a9a4c36a586be5c2693156200eadc" title="type of the interface to format each parameter">reduction_type</a> <a class="code" href="namespacehryky.html#af41cb3af6766761da0ff21b84527a52c" title="decomposes the instance to primitive objects.">reduce</a>(<a class="code" href="namespacehryky_1_1reduction.html#ac686c30a4c8d196bbd0f05629a6b921f" title="name of each format element">reduction::name_type</a> <span class="keyword">const</span> &amp; name) <span class="keyword">const</span>;

        <span class="keywordtype">size_t</span> id_;
    };
<span class="keywordtype">void</span> HelloTask::operator()(worker_type &amp;)
{
    <a class="code" href="log__writer__common_8h.html#ad94e7301fdfeec6ecd1cb63b4c81325a" title="writes log message as hryky::log::level::Kind::debug_ level.">hryky_log_debug</a>(
        *<a class="code" href="reduction__common_8h.html#afc72326c9900838c5db40438318794dd" title="reduces an object to the set of primitive objects.">hryky_reduce</a>(<span class="stringliteral">&quot;hello&quot;</span>, this-&gt;id_));
}
</pre></div></p>
<h3><a class="anchor" id="QuicksortTask"></a>
Concurrent Sorting</h3>
<p>The following code is the example of the implementation of task for <a class="el" href="classhryky_1_1task_1_1worker_1_1_batch.html" title="executes tasks in common use.">task::worker::Batch</a>. This example concurrently performs Quicksort by each partition. Each concurrent operation generates a new task internally and passes the task to own distributer.</p>
<p><div class="fragment"><pre class="fragment">    <span class="keyword">struct </span>SortTask
    {
        <span class="keyword">typedef</span> task::distributor::Batch&lt;SortTask&gt;  distributor_type;
        <span class="keyword">typedef</span> task::worker::Batch&lt;SortTask&gt;       worker_type;

        <span class="keyword">enum</span>
        {
            <span class="comment">// the lower number to create a new task recursively.</span>
            distributable_distance_ = 0x2,
        };
        
        SortTask() : begin_(<a class="code" href="common_8h.html#a4cd4ac09cfcdbd6b30ee69afc156e210" title="null pointer">HRYKY_NULLPTR</a>), end_(<a class="code" href="common_8h.html#a4cd4ac09cfcdbd6b30ee69afc156e210" title="null pointer">HRYKY_NULLPTR</a>) {}
        
        SortTask(sample_type * begin, sample_type * end)
            : begin_(begin), end_(end) {}

        <span class="comment">// sorts fixed array concurrently</span>
        <span class="keywordtype">void</span> operator()(worker_type &amp; worker);

        <a class="code" href="namespacehryky.html#a343a9a4c36a586be5c2693156200eadc" title="type of the interface to format each parameter">reduction_type</a> <a class="code" href="namespacehryky.html#af41cb3af6766761da0ff21b84527a52c" title="decomposes the instance to primitive objects.">reduce</a>(<a class="code" href="namespacehryky_1_1reduction.html#ac686c30a4c8d196bbd0f05629a6b921f" title="name of each format element">reduction::name_type</a> <span class="keyword">const</span> &amp; name) <span class="keyword">const</span>;

        sample_type *   begin_;
        sample_type *   end_;
    };
</pre></div> </p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Mon Feb 11 2013 16:52:46 for hryky-codebase by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
